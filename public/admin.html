<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel de Administraci√≥n - Promoci√≥n Mundial 2026</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            text-align: center;
        }

        .header h1 {
            color: #667eea;
            margin-bottom: 10px;
        }

        .auth-section {
            background: white;
            border-radius: 15px;
            padding: 40px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            max-width: 500px;
            margin-left: auto;
            margin-right: auto;
        }

        .role-selector {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            justify-content: center;
        }

        .role-btn {
            padding: 15px 30px;
            border: 2px solid #667eea;
            background: transparent;
            color: #667eea;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .role-btn.active {
            background: #667eea;
            color: white;
        }

        .role-btn:hover {
            background: #667eea;
            color: white;
        }

        .login-form {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .input-group {
            display: flex;
            flex-direction: column;
        }

        label {
            margin-bottom: 5px;
            font-weight: bold;
            color: #555;
        }

        input {
            padding: 12px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 1rem;
        }

        input:focus {
            outline: none;
            border-color: #667eea;
        }

        .login-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 15px;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .login-btn:hover {
            background: #5a67d8;
            transform: translateY(-2px);
        }

        .admin-panel {
            display: none;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #f0f0f0;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logout-btn {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 1rem;
            opacity: 0.9;
        }

        .filters {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
        }

        .filter-select {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background: white;
        }

        .search-input {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            min-width: 250px;
        }

        .clients-table {
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 12px 8px;
            text-align: left;
            border-bottom: 1px solid #eee;
            font-size: 0.9rem;
        }

        th {
            background: #667eea;
            color: white;
            font-weight: bold;
        }

        tr:hover {
            background: #f8f9fa;
        }

        .status-badge {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
            text-transform: uppercase;
        }

        .status-pending {
            background: #ffeaa7;
            color: #d63031;
        }

        .status-validated {
            background: #00b894;
            color: white;
        }

        .status-rejected {
            background: #e17055;
            color: white;
        }

        .status-overdue {
            background: #e74c3c;
            color: white;
        }

        .status-late {
            background: #f39c12;
            color: white;
        }

        .status-ready-delivery {
            background: #3498db;
            color: white;
        }

        .status-dispatched {
            background: #9b59b6;
            color: white;
        }

        .action-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9rem;
            margin: 2px;
            transition: all 0.3s ease;
        }

        .validate-btn {
            background: #00b894;
            color: white;
        }

        .reject-btn {
            background: #e17055;
            color: white;
        }

        .view-btn {
            background: #667eea;
            color: white;
        }

        .export-btn {
            background: #2ecc71;
            color: white;
        }

        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 800px;
            max-height: 80vh;
            overflow-y: auto;
            width: 90%;
        }

        .close-modal {
            float: right;
            font-size: 1.5rem;
            cursor: pointer;
            background: none;
            border: none;
            color: #999;
        }

        .client-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .detail-item {
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .detail-label {
            font-weight: bold;
            color: #666;
            font-size: 0.9rem;
        }

        .detail-value {
            color: #333;
            margin-top: 5px;
        }

        .cuotas-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .cuota-card {
            border: 2px solid #eee;
            border-radius: 10px;
            padding: 20px;
            background: white;
        }

        .cuota-card.pending {
            border-color: #ffeaa7;
            background: #fdfcf0;
        }

        .cuota-card.validated {
            border-color: #00b894;
            background: #f0fdf4;
        }

        .cuota-card.overdue {
            border-color: #e74c3c;
            background: #ffeaea;
        }

        .cuota-card.late {
            border-color: #f39c12;
            background: #fef9e7;
        }

        .cuota-card.ontime {
            border-color: #27ae60;
            background: #eafaf1;
        }

        .cuota-card.ready-delivery {
            border-color: #3498db;
            background: #e3f2fd;
        }

        .cuota-card.dispatched {
            border-color: #9b59b6;
            background: #f3e5f5;
        }

        .due-date {
            font-size: 0.8rem;
            color: #666;
            margin-top: 5px;
        }

        .due-date.overdue {
            color: #e74c3c;
            font-weight: bold;
        }

        .due-date.late {
            color: #f39c12;
            font-weight: bold;
        }

        .due-date.ontime {
            color: #27ae60;
        }

        .delivery-panel {
            background: #e3f2fd;
            border: 2px solid #3498db;
            border-radius: 10px;
            padding: 20px;
            margin-top: 15px;
        }

        .dispatch-panel {
            background: #f3e5f5;
            border: 2px solid #9b59b6;
            border-radius: 10px;
            padding: 20px;
            margin-top: 15px;
        }

        .delivery-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            justify-content: center;
        }

        .large-delivery-btn {
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: bold;
            transition: all 0.3s ease;
            text-transform: uppercase;
            background: #3498db;
            color: white;
        }

        .large-dispatch-btn {
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: bold;
            transition: all 0.3s ease;
            text-transform: uppercase;
            background: #9b59b6;
            color: white;
        }

        .tracking-info {
            background: white;
            border-left: 4px solid #9b59b6;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
        }

        .cuota-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .cuota-number {
            font-size: 1.5rem;
            font-weight: bold;
            color: #667eea;
        }

        .file-preview {
            background: white;
            border: 2px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            text-align: center;
        }

        .file-preview img {
            max-width: 100%;
            max-height: 300px;
            border-radius: 5px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .file-preview .pdf-placeholder {
            background: #e74c3c;
            color: white;
            padding: 40px;
            border-radius: 8px;
            font-size: 3rem;
            margin-bottom: 10px;
        }

        .download-btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            text-decoration: none;
            display: inline-block;
        }

        .validation-panel {
            background: #f8f9fa;
            border: 2px solid #ddd;
            border-radius: 10px;
            padding: 20px;
            margin-top: 15px;
        }

        .validation-panel.pending {
            border-color: #f39c12;
            background: #fef9e7;
        }

        .validation-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            justify-content: center;
        }

        .large-action-btn {
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: bold;
            transition: all 0.3s ease;
            text-transform: uppercase;
        }

        .large-validate-btn {
            background: #27ae60;
            color: white;
        }

        .large-reject-btn {
            background: #e74c3c;
            color: white;
        }

        .large-action-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(0,0,0,0.2);
        }

        .validation-history {
            background: #e8f5e8;
            border-left: 4px solid #27ae60;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
        }

        .validation-history.rejected {
            background: #fdeaea;
            border-left-color: #e74c3c;
        }

        .timestamp {
            font-size: 0.9rem;
            color: #666;
            font-style: italic;
        }

        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin-top: 20px;
        }

        .page-btn {
            padding: 8px 12px;
            border: 1px solid #ddd;
            background: white;
            cursor: pointer;
            border-radius: 5px;
        }

        .page-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .owner-actions {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .action-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .owner-btn {
            padding: 15px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .report-btn {
            background: #3498db;
            color: white;
        }

        .settings-btn {
            background: #9b59b6;
            color: white;
        }

        .alert-btn {
            background: #e74c3c;
            color: white;
        }

        .owner-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .filters {
                flex-direction: column;
                align-items: stretch;
            }
            
            .search-input {
                min-width: auto;
            }
            
            .cuotas-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head><body>
    <div class="container">
        <div class="header">
            <h1>üèÜ Panel de Administraci√≥n - Promoci√≥n Mundial 2026</h1>
            <p>Sistema de gesti√≥n y validaci√≥n de cuotas</p>
        </div>

        <!-- Secci√≥n de Autenticaci√≥n -->
        <div class="auth-section" id="authSection">
            <h2>Iniciar Sesi√≥n</h2>
            
            <div class="role-selector">
                <button class="role-btn active" onclick="selectRole('validator')">Validador</button>
                <button class="role-btn" onclick="selectRole('responsable')">Responsable</button>
                <button class="role-btn" onclick="selectRole('owner')">Due√±o</button>
            </div>

            <form class="login-form" onsubmit="login(event)">
                <div class="input-group">
                    <label for="username">Usuario:</label>
                    <input type="text" id="username" required placeholder="Ej: validator1, responsable1, owner">
                </div>
                <div class="input-group">
                    <label for="password">Contrase√±a:</label>
                    <input type="password" id="password" required placeholder="Ingresa tu contrase√±a">
                </div>
                <button type="submit" class="login-btn">Iniciar Sesi√≥n</button>
                
                <div style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px; border-left: 4px solid #667eea;">
                   
                    </div>
                </div>
            </form>
        </div>

        <!-- Panel de Administraci√≥n -->
        <div class="admin-panel" id="adminPanel">
            <div class="panel-header">
                <div class="user-info">
                    <h2 id="welcomeMsg">Bienvenido</h2>
                    <span id="userRole" class="status-badge status-validated"></span>
                </div>
                <button class="logout-btn" onclick="logout()">Cerrar Sesi√≥n</button>
            </div>

            <!-- Estad√≠sticas -->
            <div class="stats-grid" id="statsGrid">
                <!-- Las estad√≠sticas se cargar√°n din√°micamente -->
            </div>

            <!-- Acciones del Due√±o/Responsable -->
            <div class="owner-actions" id="ownerActions" style="display: none;">
                <h3>Acciones Administrativas</h3>
                <div class="action-grid" id="actionGrid">
                    <!-- Los botones se cargar√°n din√°micamente seg√∫n el rol -->
                </div>
            </div>

            <!-- Filtros -->
            <div class="filters">
                <select class="filter-select" id="statusFilter" onchange="filterData()">
                    <option value="">Todos los estados</option>
                    <option value="pending">Pendientes</option>
                    <option value="ready-delivery">Listos Entrega</option>
                    <option value="dispatched">Despachados</option>
                    <option value="delivered">Entregados</option>
                    <option value="rejected">Rechazados</option>
                </select>
                
                <select class="filter-select" id="cuotaFilter" onchange="filterData()">
                    <option value="">Todas las cuotas</option>
                    <option value="2">Cuota 2</option>
                    <option value="3">Cuota 3</option>
                    <option value="4">Cuota 4</option>
                    <option value="5">Cuota 5</option>
                    <option value="6">Cuota 6</option>
                    <option value="7">Cuota 7</option>
                    <option value="8">Cuota 8</option>
                    <option value="9">Cuota 9</option>
                    <option value="10">Cuota 10</option>
                    <option value="11">Cuota 11</option>
                    <option value="12">Cuota 12</option>
                </select>

                <select class="filter-select" id="monthFilter" onchange="filterData()">
                    <option value="">Todos los meses</option>
                    <option value="Octubre">Octubre</option>
                    <option value="Noviembre">Noviembre</option>
                    <option value="Diciembre">Diciembre</option>
                    <option value="Enero">Enero</option>
                    <option value="Febrero">Febrero</option>
                    <option value="Marzo">Marzo</option>
                    <option value="Abril">Abril</option>
                    <option value="Mayo">Mayo</option>
                    <option value="Junio">Junio</option>
                    <option value="Julio">Julio</option>
                    <option value="Agosto">Agosto</option>
                </select>

                <input type="text" class="search-input" id="searchInput" placeholder="Buscar por nombre, DNI, email..." onkeyup="filterData()">
                
                <button class="action-btn view-btn" onclick="refreshData()">üîÑ Actualizar</button>
                <button class="action-btn validate-btn" onclick="showOnlyPending()">‚è≥ Pendientes</button>
                <button class="action-btn reject-btn" onclick="clearFilters()">üóëÔ∏è Limpiar</button>
            </div>

            <!-- Tabla de Clientes -->
            <div class="clients-table">
                <table>
                    <thead>
                        <tr>
                            <th style="width: 15%;">Cliente</th>
                            <th style="width: 10%;">DNI</th>
                            <th style="width: 20%;">Email</th>
                            <th style="width: 15%;">Plan</th>
                            <th style="width: 10%;">Pend.</th>
                            <th style="width: 10%;">Valid.</th>
                            <th style="width: 20%;">Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="clientsTableBody">
                        <!-- Los datos se cargar√°n din√°micamente -->
                    </tbody>
                </table>
            </div>

            <!-- Paginaci√≥n -->
            <div class="pagination" id="pagination">
                <!-- Los botones de paginaci√≥n se generar√°n din√°micamente -->
            </div>
        </div>
    </div>

    <!-- Modal para detalles del cliente -->
    <div class="modal" id="clientModal">
        <div class="modal-content">
            <button class="close-modal" onclick="closeModal()">&times;</button>
            <h2>Detalles del Cliente</h2>
            
            <div class="client-details" id="clientDetails">
                <!-- Los detalles se cargar√°n din√°micamente -->
            </div>

            <h3>Estado de Cuotas</h3>
            <div class="cuotas-grid" id="cuotasGrid">
                <!-- Las cuotas se cargar√°n din√°micamente -->
            </div>
        </div>
    </div>

    <script>// Variables globales
        let currentUser = null;
        let currentRole = 'validator';
        let clientsData = [];
        let filteredData = [];
        let currentPage = 1;
        const itemsPerPage = 10;
        const cuotaDueDates = {
            2: { month: 'Octubre', day: 25, year: 2024 },
            3: { month: 'Noviembre', day: 25, year: 2024 },
            4: { month: 'Diciembre', day: 25, year: 2024 },
            5: { month: 'Enero', day: 25, year: 2025 },
            6: { month: 'Febrero', day: 25, year: 2025 },
            7: { month: 'Marzo', day: 25, year: 2025 },
            8: { month: 'Abril', day: 25, year: 2025 },
            9: { month: 'Mayo', day: 25, year: 2025 },
            10: { month: 'Junio', day: 25, year: 2025 },
            11: { month: 'Julio', day: 25, year: 2025 },
            12: { month: 'Agosto', day: 25, year: 2025 }
        };

        function getCuotaDueDate(cuotaNumber) {
            const due = cuotaDueDates[cuotaNumber];
            if (!due) return 'No definida';
            return `${due.day}/${due.month.substring(0,3)}/${due.year}`;
        }

        function getCuotaStatus(cuotaNumber, uploadDate = null) {
            const due = cuotaDueDates[cuotaNumber];
            if (!due) return 'normal';
            
            const dueDate = new Date(due.year, getMonthNumber(due.month) - 1, due.day);
            const today = new Date();
            const upload = uploadDate ? new Date(uploadDate) : null;
            
            if (upload && upload > dueDate) {
                return 'late';
            } else if (today > dueDate && !upload) {
                return 'overdue';
            } else if (today <= dueDate) {
                return 'ontime';
            }
            return 'normal';
        }

        function getMonthNumber(monthName) {
            const months = {
                'Enero': 1, 'Febrero': 2, 'Marzo': 3, 'Abril': 4,
                'Mayo': 5, 'Junio': 6, 'Julio': 7, 'Agosto': 8,
                'Septiembre': 9, 'Octubre': 10, 'Noviembre': 11, 'Diciembre': 12
            };
            return months[monthName] || 1;
        }

        // Usuarios del sistema
        const systemUsers = {
            'validator1': { password: 'val123', role: 'validator', name: 'Mar√≠a Gonz√°lez' },
            'validator2': { password: 'val456', role: 'validator', name: 'Carlos P√©rez' },
            'responsable1': { password: 'resp123', role: 'responsable', name: 'Ana Garc√≠a' },
            'responsable2': { password: 'resp456', role: 'responsable', name: 'Luis Mart√≠n' },
            'owner': { password: 'admin123', role: 'owner', name: 'Roberto L√≥pez' }
        };

        // Datos de ejemplo de clientes (simulando archivos reales)
        const mockClientsData = [
            {
                id: 1,
                nombre: 'Juan Carlos',
                apellido: 'P√©rez',
                dni: '12345678',
                email: 'juan.perez@email.com',
                telefono: '11-1234-5678',
                plan: 'Corolla 2024 - Plan Premium',
                direccion: 'Av. Corrientes 1234',
                localidad: 'Buenos Aires',
                cp: '1000',
                registrationDate: '2024-01-15',
                mesCuota2: 'Octubre',
                cuotas: {
                    2: { 
                        status: 'dispatched', 
                        file: 'comprobante_cuota2.pdf', 
                        fileType: 'pdf',
                        fileUrl: 'data:application/pdf;base64,sample', 
                        uploadDate: '2024-10-20', 
                        validatedBy: 'Mar√≠a Gonz√°lez', 
                        validationDate: '2024-10-21',
                        dispatchedBy: 'Roberto L√≥pez',
                        dispatchDate: '2024-10-25',
                        trackingNumber: 'TR12345678',
                        carrier: 'Correo Argentino',
                        estimatedDays: '3-5'
                    },
                    3: { 
                        status: 'pending', 
                        file: 'comprobante_cuota3.jpg', 
                        fileType: 'image',
                        fileUrl: 'https://via.placeholder.com/600x400/74b9ff/ffffff?text=COMPROBANTE+CUOTA+3',
                        uploadDate: '2024-11-28' 
                    },
                    4: { 
                        status: 'rejected', 
                        file: 'comprobante_cuota4.pdf', 
                        fileType: 'pdf',
                        fileUrl: 'data:application/pdf;base64,sample',
                        uploadDate: '2024-12-05', 
                        rejectedBy: 'Carlos P√©rez', 
                        rejectionDate: '2024-12-06', 
                        reason: 'Documento ilegible' 
                    },
                    5: { 
                        status: 'pending', 
                        file: 'cuota5_enero.jpg', 
                        fileType: 'image',
                        fileUrl: 'https://via.placeholder.com/600x400/f39c12/ffffff?text=CUOTA+ENERO+PENDIENTE',
                        uploadDate: '2025-01-30' 
                    }
                }
            },
            {
                id: 2,
                nombre: 'Ana Mar√≠a',
                apellido: 'Gonz√°lez',
                dni: '87654321',
                email: 'ana.gonzalez@email.com',
                telefono: '11-8765-4321',
                plan: 'Civic 2024 - Plan Est√°ndar',
                direccion: 'Av. Santa Fe 5678',
                localidad: 'Buenos Aires',
                cp: '1425',
                registrationDate: '2024-01-20',
                mesCuota2: 'Noviembre',
                cuotas: {
                    2: { 
                        status: 'validated', 
                        file: 'comp_2.pdf', 
                        fileType: 'pdf',
                        fileUrl: 'data:application/pdf;base64,sample',
                        uploadDate: '2024-02-20', 
                        validatedBy: 'Mar√≠a Gonz√°lez', 
                        validationDate: '2024-02-21' 
                    },
                    3: { 
                        status: 'validated', 
                        file: 'comp_3.jpg', 
                        fileType: 'image',
                        fileUrl: 'https://via.placeholder.com/600x400/27ae60/ffffff?text=COMPROBANTE+VALIDADO',
                        uploadDate: '2024-03-15', 
                        validatedBy: 'Carlos P√©rez', 
                        validationDate: '2024-03-16' 
                    },
                    4: { 
                        status: 'pending', 
                        file: 'comp_4.pdf', 
                        fileType: 'pdf',
                        fileUrl: 'data:application/pdf;base64,sample',
                        uploadDate: '2024-04-12' 
                    },
                    5: { 
                        status: 'pending', 
                        file: 'comp_5.jpg', 
                        fileType: 'image',
                        fileUrl: 'https://via.placeholder.com/600x400/f39c12/ffffff?text=COMPROBANTE+PENDIENTE',
                        uploadDate: '2024-05-08' 
                    }
                }
            },
            {
                id: 3,
                nombre: 'Roberto',
                apellido: 'Mart√≠nez',
                dni: '11223344',
                email: 'roberto.martinez@email.com',
                telefono: '11-2233-4455',
                plan: 'Camry 2024 - Plan Premium',
                direccion: 'Av. Rivadavia 9876',
                localidad: 'CABA',
                cp: '1200',
                registrationDate: '2024-02-01',
                mesCuota2: 'Diciembre',
                cuotas: {
                    2: { 
                        status: 'validated', 
                        file: 'cuota2_roberto.pdf', 
                        fileType: 'pdf',
                        fileUrl: 'data:application/pdf;base64,sample',
                        uploadDate: '2024-11-20', 
                        validatedBy: 'Mar√≠a Gonz√°lez', 
                        validationDate: '2024-11-21' 
                    },
                    3: { 
                        status: 'pending', 
                        file: 'cuota3_roberto.jpg', 
                        fileType: 'image',
                        fileUrl: 'https://via.placeholder.com/600x400/74b9ff/ffffff?text=COMPROBANTE+BANCO+NACI√ìN',
                        uploadDate: '2024-12-20' 
                    }
                }
            },
            {
                id: 4,
                nombre: 'Mar√≠a Elena',
                apellido: 'Rodriguez',
                dni: '98765432',
                email: 'maria.rodriguez@email.com',
                telefono: '11-9876-5432',
                plan: 'Sentra 2024 - Plan B√°sico',
                direccion: 'Calle Falsa 123',
                localidad: 'Quilmes',
                cp: '1878',
                registrationDate: '2024-03-15',
                mesCuota2: 'Enero',
                cuotas: {
                    2: { 
                        status: 'validated', 
                        file: 'maria_cuota2.pdf', 
                        fileType: 'pdf',
                        fileUrl: 'data:application/pdf;base64,sample',
                        uploadDate: '2024-12-22', 
                        validatedBy: 'Carlos P√©rez', 
                        validationDate: '2024-12-23' 
                    },
                    3: { 
                        status: 'pending', 
                        file: 'maria_cuota3.jpg', 
                        fileType: 'image',
                        fileUrl: 'https://via.placeholder.com/600x400/e74c3c/ffffff?text=ENERO+PENDIENTE',
                        uploadDate: '2025-01-20' 
                    }
                }
            }
        ];

        function selectRole(role) {
            currentRole = role;
            document.querySelectorAll('.role-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
        }

        async function login(event) {
    event.preventDefault();
    
    const email = document.getElementById('username').value;
    const password = document.getElementById('password').value;
    
    try {
        const response = await fetch('/api/auth/login', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                email: email,
                password: password,
                role: currentRole  // CR√çTICO: enviar el rol seleccionado
            })
        });
        
        const data = await response.json();
        
        if (!response.ok) {
            alert(data.message || 'Usuario o contrase√±a incorrectos');
            return;
        }
        
        // Guardar token y datos de usuario
        localStorage.setItem('token', data.token);
        currentUser = {
            ...data.user,
            name: `${data.user.nombre} ${data.user.apellido}`
        };
        
        showAdminPanel();
        
    } catch (error) {
        console.error('Error en login:', error);
        alert('Error al conectar con el servidor');
    }
}

        function showAdminPanel() {
            document.getElementById('authSection').style.display = 'none';
            document.getElementById('adminPanel').style.display = 'block';
            
            const headerTitle = document.querySelector('.header h1');
            const headerSubtitle = document.querySelector('.header p');
            
            if (currentUser.role === 'owner') {
                document.getElementById('welcomeMsg').textContent = `Bienvenido/a ${currentUser.name} - Panel del Due√±o`;
                document.getElementById('userRole').textContent = 'Administrador Principal';
                document.getElementById('userRole').className = 'status-badge status-validated';
                document.getElementById('ownerActions').style.display = 'block';
                
                headerTitle.textContent = 'üëë Panel del Due√±o - Promoci√≥n Mundial 2026';
                headerSubtitle.textContent = 'Gesti√≥n completa: validaci√≥n, entrega y administraci√≥n';
                
                updateOwnerFilters();
                setupOwnerActions();
                
            } else if (currentUser.role === 'validator') {
                document.getElementById('welcomeMsg').textContent = `Bienvenido/a ${currentUser.name} - Panel del Validador`;
                document.getElementById('userRole').textContent = 'Validador de Cuotas';
                document.getElementById('userRole').className = 'status-badge status-pending';
                document.getElementById('ownerActions').style.display = 'none';
                
                headerTitle.textContent = 'üîç Panel del Validador - Promoci√≥n Mundial 2026';
                headerSubtitle.textContent = 'Revisi√≥n y validaci√≥n de comprobantes de pago';
                
                updateValidatorFilters();
                
            } else if (currentUser.role === 'responsable') {
                setupResponsablePanel();
            }
            
            loadClientsData();
            updateStats();
        }

        function setupResponsablePanel() {
            const headerTitle = document.querySelector('.header h1');
            const headerSubtitle = document.querySelector('.header p');
            headerTitle.textContent = 'üìã Panel del Responsable - Promoci√≥n Mundial 2026';
            headerSubtitle.textContent = 'Gesti√≥n de entregas, importaci√≥n y administraci√≥n operativa';
            
            document.getElementById('welcomeMsg').textContent = `Bienvenido/a ${currentUser.name} - Panel del Responsable`;
            document.getElementById('userRole').textContent = 'Responsable de Gesti√≥n';
            document.getElementById('userRole').className = 'status-badge status-ready-delivery';
            
            document.getElementById('ownerActions').style.display = 'block';
            
            const ownerActionsDiv = document.getElementById('ownerActions');
            ownerActionsDiv.querySelector('h3').textContent = 'Acciones del Responsable';
            
            const actionGrid = document.getElementById('actionGrid');
            actionGrid.innerHTML = `
                <button class="owner-btn report-btn" onclick="generateReport()">
                    üìã Generar Reporte
                </button>
                <button class="owner-btn alert-btn" onclick="sendAlerts()">
                    üìß Enviar Alertas
                </button>
                <button class="owner-btn" onclick="showDetailedStats()" style="background: #9b59b6;">
                    üìà Estad√≠sticas
                </button>
                <button class="owner-btn export-btn" onclick="exportData()">
                    üìä Exportar Datos
                </button>
            `;
            
            const statusFilter = document.getElementById('statusFilter');
            statusFilter.innerHTML = `
                <option value="">Todos los estados</option>
                <option value="ready-delivery">Listos para Entrega</option>
                <option value="dispatched">Despachados</option>
                <option value="delivered">Entregados</option>
                <option value="pending">Pendientes (referencia)</option>
                <option value="rejected">Rechazados (referencia)</option>
            `;
            
            document.querySelectorAll('.role-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.role-btn')[1].classList.add('active');
        }

        function setupOwnerActions() {
            const actionGrid = document.getElementById('actionGrid');
            actionGrid.innerHTML = `
                <button class="owner-btn export-btn" onclick="exportData()">
                    üìä Exportar Todo
                </button>
                <button class="owner-btn export-btn" onclick="exportPendingOnly()">
                    ‚è≥ Solo Pendientes
                </button>
                <button class="owner-btn report-btn" onclick="generateReport()">
                    üìã Generar Reporte
                </button>
                <button class="owner-btn settings-btn" onclick="openSettings()">
                    ‚öôÔ∏è Configuraci√≥n
                </button>
                <button class="owner-btn alert-btn" onclick="sendAlerts()">
                    üìß Enviar Alertas
                </button>
                <button class="owner-btn" onclick="showDetailedStats()" style="background: #9b59b6;">
                    üìà Estad√≠sticas
                </button>
            `;
        }

        function updateOwnerFilters() {
            const statusFilter = document.getElementById('statusFilter');
            statusFilter.innerHTML = `
                <option value="">Todos los estados</option>
                <option value="pending">Pendientes Validaci√≥n</option>
                <option value="ready-delivery">Listos para Entrega</option>
                <option value="dispatched">Despachados</option>
                <option value="delivered">Entregados</option>
                <option value="rejected">Rechazados</option>
            `;
        }

        function updateValidatorFilters() {
            const statusFilter = document.getElementById('statusFilter');
            statusFilter.innerHTML = `
                <option value="">Todos los estados</option>
                <option value="pending">Pendientes Validaci√≥n</option>
                <option value="ready-delivery">Validados</option>
                <option value="rejected">Rechazados</option>
            `;
        }

        function logout() {
            currentUser = null;
            
            document.getElementById('adminPanel').style.display = 'none';
            document.getElementById('authSection').style.display = 'block';
            
            const headerTitle = document.querySelector('.header h1');
            const headerSubtitle = document.querySelector('.header p');
            headerTitle.textContent = 'üèÜ Panel de Administraci√≥n - Promoci√≥n Mundial 2026';
            headerSubtitle.textContent = 'Sistema de gesti√≥n y validaci√≥n de cuotas';
            
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
            
            document.querySelectorAll('.role-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelector('.role-btn').classList.add('active');
            currentRole = 'validator';
        }

        function loadClientsData() {
            clientsData = [...mockClientsData];
            filteredData = [...clientsData];
            renderTable();
        }

        function updateStats() {
            const totalClients = clientsData.length;
            let totalPending = 0;
            let totalValidated = 0;
            let totalRejected = 0;
            let totalReadyDelivery = 0;
            let totalDispatched = 0;
            let totalDelivered = 0;
            
            clientsData.forEach(client => {
                Object.values(client.cuotas).forEach(cuota => {
                    switch(cuota.status) {
                        case 'pending': totalPending++; break;
                        case 'ready-delivery': totalReadyDelivery++; break;
                        case 'dispatched': totalDispatched++; break;
                        case 'delivered': totalDelivered++; break;
                        case 'rejected': totalRejected++; break;
                        case 'validated': totalValidated++; break;
                    }
                });
            });
            
            let statsHtml = '';
            
            if (currentUser.role === 'validator') {
                statsHtml = `
                    <div class="stat-card">
                        <div class="stat-number">${totalClients}</div>
                        <div class="stat-label">Total Clientes</div>
                    </div>
                    <div class="stat-card" style="background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);">
                        <div class="stat-number">${totalPending}</div>
                        <div class="stat-label">Pendientes Validaci√≥n</div>
                    </div>
                    <div class="stat-card" style="background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);">
                        <div class="stat-number">${totalReadyDelivery + totalValidated}</div>
                        <div class="stat-label">Validados</div>
                    </div>
                    <div class="stat-card" style="background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);">
                        <div class="stat-number">${totalRejected}</div>
                        <div class="stat-label">Rechazados</div>
                    </div>
                `;
            } else if (currentUser.role === 'responsable') {
                statsHtml = `
                    <div class="stat-card">
                        <div class="stat-number">${totalClients}</div>
                        <div class="stat-label">Total Clientes</div>
                    </div>
                    <div class="stat-card" style="background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);">
                        <div class="stat-number">${totalReadyDelivery}</div>
                        <div class="stat-label">Listos Entrega</div>
                    </div>
                    <div class="stat-card" style="background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%);">
                        <div class="stat-number">${totalDispatched}</div>
                        <div class="stat-label">Despachados</div>
                    </div>
                    <div class="stat-card" style="background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);">
                        <div class="stat-number">${totalDelivered}</div>
                        <div class="stat-label">Entregados</div>
                    </div>
                    <div class="stat-card" style="background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);">
                        <div class="stat-number">${totalPending}</div>
                        <div class="stat-label">Pendientes</div>
                    </div>
                `;
            } else {
                statsHtml = `
                    <div class="stat-card">
                        <div class="stat-number">${totalClients}</div>
                        <div class="stat-label">Total Clientes</div>
                    </div>
                    <div class="stat-card" style="background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);">
                        <div class="stat-number">${totalPending}</div>
                        <div class="stat-label">Pendientes</div>
                    </div>
                    <div class="stat-card" style="background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);">
                        <div class="stat-number">${totalReadyDelivery}</div>
                        <div class="stat-label">Listos Entrega</div>
                    </div>
                    <div class="stat-card" style="background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%);">
                        <div class="stat-number">${totalDispatched}</div>
                        <div class="stat-label">Despachados</div>
                    </div>
                    <div class="stat-card" style="background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);">
                        <div class="stat-number">${totalDelivered}</div>
                        <div class="stat-label">Entregados</div>
                    </div>
                    <div class="stat-card" style="background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);">
                        <div class="stat-number">${totalRejected}</div>
                        <div class="stat-label">Rechazadas</div>
                    </div>
                `;
            }
            
            document.getElementById('statsGrid').innerHTML = statsHtml;
        }

        function filterData() {
            const statusFilter = document.getElementById('statusFilter').value;
            const cuotaFilter = document.getElementById('cuotaFilter').value;
            const monthFilter = document.getElementById('monthFilter').value;
            const searchText = document.getElementById('searchInput').value.toLowerCase();
            
            filteredData = clientsData.filter(client => {
                if (searchText && !client.nombre.toLowerCase().includes(searchText) && 
                    !client.apellido.toLowerCase().includes(searchText) &&
                    !client.dni.includes(searchText) &&
                    !client.email.toLowerCase().includes(searchText)) {
                    return false;
                }
                
                if (statusFilter || cuotaFilter || monthFilter) {
                    const cuotasToCheck = cuotaFilter ? [cuotaFilter] : Object.keys(client.cuotas);
                    return cuotasToCheck.some(cuotaNum => {
                        const cuota = client.cuotas[cuotaNum];
                        
                        if (statusFilter && (!cuota || cuota.status !== statusFilter)) {
                            return false;
                        }
                        
                        if (monthFilter) {
                            const clientDueDate = getClientCuotaDueDate(client, parseInt(cuotaNum));
                            if (clientDueDate.month !== monthFilter) {
                                return false;
                            }
                        }
                        
                        return true;
                    });
                }
                
                return true;
            });
            
            currentPage = 1;
            renderTable();
        }

        function getClientCuotaDueDate(client, cuotaNumber) {
            if (client.mesCuota2) {
                const baseMonth = getMonthNumber(client.mesCuota2);
                const targetMonth = ((baseMonth - 1 + (cuotaNumber - 2)) % 12) + 1;
                const monthNames = ['', 'Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio', 'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'];
                
                let year = 2024;
                if (client.mesCuota2 === 'Enero' || client.mesCuota2 === 'Febrero' || client.mesCuota2 === 'Marzo') {
                    year = 2025;
                } else if (targetMonth < baseMonth && baseMonth >= 10) {
                    year = 2025;
                }
                
                return {
                    month: monthNames[targetMonth],
                    day: 25,
                    year: year
                };
            } else {
                const clientCycle = (client.id - 1) % 12;
                const baseMonth = getMonthNumber('Octubre');
                const targetMonth = (baseMonth + clientCycle + (cuotaNumber - 2)) % 12;
                const monthNames = ['Diciembre', 'Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio', 'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre'];
                
                return {
                    month: monthNames[targetMonth],
                    day: 25,
                    year: targetMonth < baseMonth ? 2025 : 2024
                };
            }
        }

        function renderTable() {
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const pageData = filteredData.slice(startIndex, endIndex);
            
            const tbody = document.getElementById('clientsTableBody');
            tbody.innerHTML = '';
            
            pageData.forEach(client => {
                const pendingCuotas = Object.entries(client.cuotas).filter(([_, cuota]) => cuota.status === 'pending').length;
                const validatedCuotas = Object.entries(client.cuotas).filter(([_, cuota]) => 
                    cuota.status === 'ready-delivery' || cuota.status === 'dispatched' || cuota.status === 'delivered' || cuota.status === 'validated'
                ).length;
                
                const shortPlan = client.plan.replace('2024 - Plan ', '').replace('Premium', 'Prem').replace('Est√°ndar', 'Est');
                
                const row = document.createElement('tr');
                
                let actionsButtons = '';
                if (currentUser.role === 'validator') {
                    actionsButtons = `<button class="action-btn view-btn" onclick="viewClient(${client.id})" style="font-size: 0.8rem; padding: 6px 12px;">Validar</button>`;
                } else if (currentUser.role === 'responsable') {
                    actionsButtons = `<button class="action-btn view-btn" onclick="viewClient(${client.id})" style="font-size: 0.8rem; padding: 6px 12px; background: #3498db;">Gestionar</button>`;
                } else if (currentUser.role === 'owner') {
                    actionsButtons = `
                        <button class="action-btn view-btn" onclick="viewClient(${client.id})" style="font-size: 0.8rem; padding: 6px 12px;">Ver Todo</button>
                        <button class="action-btn export-btn" onclick="exportClient(${client.id})" style="font-size: 0.8rem; padding: 6px 12px;">Exp</button>
                    `;
                }
                
                row.innerHTML = `
                    <td style="font-weight: bold;">${client.nombre} ${client.apellido}</td>
                    <td>${client.dni}</td>
                    <td style="font-size: 0.8rem;">${client.email}</td>
                    <td style="font-size: 0.8rem;">${shortPlan}</td>
                    <td style="text-align: center;"><span class="status-badge status-pending">${pendingCuotas}</span></td>
                    <td style="text-align: center;"><span class="status-badge status-validated">${validatedCuotas}</span></td>
                    <td>${actionsButtons}</td>
                `;
                tbody.appendChild(row);
            });
            
            renderPagination();
        }function renderPagination() {
            const totalPages = Math.ceil(filteredData.length / itemsPerPage);
            const pagination = document.getElementById('pagination');
            pagination.innerHTML = '';
            
            if (totalPages <= 1) return;
            
            if (currentPage > 1) {
                const prevBtn = document.createElement('button');
                prevBtn.className = 'page-btn';
                prevBtn.textContent = '¬´ Anterior';
                prevBtn.onclick = () => changePage(currentPage - 1);
                pagination.appendChild(prevBtn);
            }
            
            for (let i = 1; i <= totalPages; i++) {
                if (i === 1 || i === totalPages || (i >= currentPage - 2 && i <= currentPage + 2)) {
                    const pageBtn = document.createElement('button');
                    pageBtn.className = `page-btn ${i === currentPage ? 'active' : ''}`;
                    pageBtn.textContent = i;
                    pageBtn.onclick = () => changePage(i);
                    pagination.appendChild(pageBtn);
                } else if (i === currentPage - 3 || i === currentPage + 3) {
                    const ellipsis = document.createElement('span');
                    ellipsis.textContent = '...';
                    pagination.appendChild(ellipsis);
                }
            }
            
            if (currentPage < totalPages) {
                const nextBtn = document.createElement('button');
                nextBtn.className = 'page-btn';
                nextBtn.textContent = 'Siguiente ¬ª';
                nextBtn.onclick = () => changePage(currentPage + 1);
                pagination.appendChild(nextBtn);
            }
        }

        function changePage(page) {
            currentPage = page;
            renderTable();
        }

        function viewClient(clientId) {
            const client = clientsData.find(c => c.id === clientId);
            if (!client) return;
            
            const clientDetails = document.getElementById('clientDetails');
            clientDetails.innerHTML = `
                <div class="detail-item">
                    <div class="detail-label">Nombre Completo</div>
                    <div class="detail-value">${client.nombre} ${client.apellido}</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">DNI</div>
                    <div class="detail-value">${client.dni}</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Email</div>
                    <div class="detail-value">${client.email}</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Tel√©fono</div>
                    <div class="detail-value">${client.telefono}</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Plan</div>
                    <div class="detail-value">${client.plan}</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Direcci√≥n</div>
                    <div class="detail-value">${client.direccion}, ${client.localidad} (${client.cp})</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Fecha de Registro</div>
                    <div class="detail-value">${client.registrationDate}</div>
                </div>
            `;
            
            const cuotasGrid = document.getElementById('cuotasGrid');
            cuotasGrid.innerHTML = '';
            
            for (let i = 2; i <= 12; i++) {
                const cuota = client.cuotas[i];
                const cuotaCard = document.createElement('div');
                
                let timeStatus = 'normal';
                if (cuota) {
                    timeStatus = getCuotaStatus(i, cuota.uploadDate);
                } else {
                    timeStatus = getCuotaStatus(i, null);
                }
                
                cuotaCard.className = `cuota-card ${cuota ? cuota.status : 'not-uploaded'} ${timeStatus}`;
                
                let statusHtml = '';
                let filePreviewHtml = '';
                let actionsHtml = '';
                let historyHtml = '';
                let dueDateHtml = '';
                
                const clientDueDate = getClientCuotaDueDate(client, i);
                const dueDate = `${clientDueDate.day}/${clientDueDate.month.substring(0,3)}/${clientDueDate.year}`;
                let dueDateClass = timeStatus;
                
                if (cuota && cuota.status === 'validated') {
                    dueDateClass = 'validated';
                } else if (cuota && cuota.status === 'rejected') {
                    dueDateClass = 'rejected';
                }
                
                dueDateHtml = `<div class="due-date ${dueDateClass}">Vence: ${dueDate} (${clientDueDate.month})</div>`;
                
                if (cuota) {
                    if (cuota.fileType === 'image') {
                        filePreviewHtml = `
                            <div class="file-preview">
                                <img src="${cuota.fileUrl}" alt="Comprobante Cuota ${i}" onclick="openImageModal('${cuota.fileUrl}', '${cuota.file}')">
                                <div>
                                    <strong>Archivo:</strong> ${cuota.file}<br>
                                    <strong>Subido:</strong> ${cuota.uploadDate}
                                </div>
                            </div>
                        `;
                    } else if (cuota.fileType === 'pdf') {
                        filePreviewHtml = `
                            <div class="file-preview">
                                <div class="pdf-placeholder">üìÑ</div>
                                <div>
                                    <strong>Archivo PDF:</strong> ${cuota.file}<br>
                                    <strong>Subido:</strong> ${cuota.uploadDate}<br>
                                    <a href="#" class="download-btn" onclick="downloadFile('${cuota.file}', '${cuota.fileUrl}')">
                                        üì• Descargar PDF
                                    </a>
                                    <button class="download-btn" onclick="viewPdfModal('${cuota.file}')">
                                        üëÅÔ∏è Vista Previa
                                    </button>
                                </div>
                            </div>
                        `;
                    }
                    
                    switch (cuota.status) {
                        case 'pending':
                            statusHtml = '<span class="status-badge status-pending">‚è≥ Pendiente de Validaci√≥n</span>';
                            if (timeStatus === 'late') {
                                statusHtml += '<br><span class="status-badge status-late">‚ö†Ô∏è Subido Tarde</span>';
                            }
                            
                            if (currentUser.role === 'validator' || currentUser.role === 'owner') {
                                actionsHtml = `
                                    <div class="validation-panel pending">
                                        <h4>üîç Revisar Comprobante</h4>
                                        <p><strong>Instrucciones:</strong> Revisa cuidadosamente el comprobante de pago. Verifica que coincidan los datos del cliente, monto y fecha.</p>
                                        <div class="validation-actions">
                                            <button class="large-action-btn large-validate-btn" onclick="validateCuota(${clientId}, ${i}, true)">
                                                ‚úÖ VALIDAR CUOTA
                                            </button>
                                            <button class="large-action-btn large-reject-btn" onclick="validateCuota(${clientId}, ${i}, false)">
                                                ‚ùå RECHAZAR
                                            </button>
                                        </div>
                                    </div>
                                `;
                            }
                            break;
                            
                        case 'ready-delivery':
                        case 'validated':
                            if (currentUser.role === 'validator') {
                                statusHtml = `<span class="status-badge status-validated">‚úÖ Validado - Aprobado</span>`;
                                actionsHtml = `
                                    <div class="validation-panel">
                                        <p><strong>‚úÖ Validaci√≥n Completada</strong><br>El premio est√° en proceso de entrega por parte del responsable/administrador.</p>
                                    </div>
                                `;
                            } else if (currentUser.role === 'responsable') {
                                statusHtml = `<span class="status-badge status-ready-delivery">üì¶ Listo para Entrega</span>`;
                                actionsHtml = `
                                    <div class="delivery-panel">
                                        <h4>üì¶ Gesti√≥n de Entrega</h4>
                                        <p><strong>El premio est√° validado y listo para ser despachado.</strong></p>
                                        <div class="delivery-actions">
                                            <button class="large-delivery-btn" onclick="dispatchPrize(${clientId}, ${i})">
                                                üöö DESPACHAR PREMIO
                                            </button>
                                        </div>
                                    </div>
                                `;
                            } else if (currentUser.role === 'owner') {
                                statusHtml = `<span class="status-badge status-ready-delivery">üì¶ Listo para Entrega</span>`;
                                actionsHtml = `
                                    <div class="delivery-panel">
                                        <h4>üì¶ Gesti√≥n de Entrega</h4>
                                        <p><strong>El premio est√° listo para ser despachado al cliente.</strong></p>
                                        <div class="delivery-actions">
                                            <button class="large-delivery-btn" onclick="dispatchPrize(${clientId}, ${i})">
                                                üöö DESPACHAR PREMIO
                                            </button>
                                        </div>
                                    </div>
                                `;
                            }
                            
                            historyHtml = `
                                <div class="validation-history">
                                    <strong>‚úÖ Cuota Validada</strong><br>
                                    <strong>Validador:</strong> ${cuota.validatedBy}<br>
                                    <strong>Fecha:</strong> ${cuota.validationDate}<br>
                                    <div class="timestamp">Cliente notificado - Premio aprobado</div>
                                </div>
                            `;
                            break;
                            
                        case 'dispatched':
                            if (currentUser.role === 'validator') {
                                statusHtml = `<span class="status-badge status-dispatched">üì¶ Premio en Camino</span>`;
                                if (cuota.trackingNumber) {
                                    actionsHtml = `
                                        <div class="dispatch-panel">
                                            <h4>üìã Informaci√≥n de Env√≠o</h4>
                                            <div class="tracking-info">
                                                <strong>N√∫mero de seguimiento:</strong> ${cuota.trackingNumber}<br>
                                                <strong>Empresa:</strong> ${cuota.carrier}<br>
                                                <strong>Tiempo estimado:</strong> ${cuota.estimatedDays} d√≠as<br>
                                                <strong>Estado:</strong> En tr√°nsito al cliente
                                            </div>
                                        </div>
                                    `;
                                }
                            } else if (currentUser.role === 'responsable') {
                                statusHtml = `<span class="status-badge status-dispatched">üöö Despachado</span>`;
                                if (cuota.trackingNumber) {
                                    actionsHtml = `
                                        <div class="dispatch-panel">
                                            <h4>üìã Informaci√≥n de Env√≠o</h4>
                                            <div class="tracking-info">
                                                <strong>N√∫mero de seguimiento:</strong> ${cuota.trackingNumber}<br>
                                                <strong>Empresa:</strong> ${cuota.carrier}<br>
                                                <strong>Tiempo estimado:</strong> ${cuota.estimatedDays} d√≠as<br>
                                                <strong>Estado:</strong> En tr√°nsito
                                            </div>
                                            <div class="delivery-actions">
                                                <button class="action-btn view-btn" onclick="resendTrackingEmail(${clientId}, ${i})">
                                                    üìß Reenviar Info
                                                </button>
                                                <button class="action-btn export-btn" onclick="markAsDelivered(${clientId}, ${i})">
                                                    ‚úÖ Marcar Entregado
                                                </button>
                                            </div>
                                        </div>
                                    `;
                                }
                            } else if (currentUser.role === 'owner') {
                                statusHtml = `<span class="status-badge status-dispatched">üöö Despachado</span>`;
                                if (cuota.trackingNumber) {
                                    actionsHtml = `
                                        <div class="dispatch-panel">
                                            <h4>üìã Informaci√≥n de Env√≠o</h4>
                                            <div class="tracking-info">
                                                <strong>N√∫mero de seguimiento:</strong> ${cuota.trackingNumber}<br>
                                                <strong>Empresa:</strong> ${cuota.carrier}<br>
                                                <strong>Tiempo estimado:</strong> ${cuota.estimatedDays} d√≠as<br>
                                                <strong>Estado:</strong> En tr√°nsito
                                            </div>
                                            <div class="delivery-actions">
                                                <button class="action-btn view-btn" onclick="resendTrackingEmail(${clientId}, ${i})">
                                                    üìß Reenviar Info
                                                </button>
                                                <button class="action-btn export-btn" onclick="markAsDelivered(${clientId}, ${i})">
                                                    ‚úÖ Marcar Entregado
                                                </button>
                                            </div>
                                        </div>
                                    `;
                                }
                            }
                            
                            historyHtml = `
                                <div class="validation-history">
                                    <strong>üöö Premio Despachado</strong><br>
                                    <strong>Despachado por:</strong> ${cuota.dispatchedBy}<br>
                                    <strong>Fecha:</strong> ${cuota.dispatchDate}<br>
                                    <div class="timestamp">Cliente notificado con informaci√≥n de seguimiento</div>
                                </div>
                            `;
                            break;
                            
                        case 'delivered':
                            statusHtml = `<span class="status-badge status-validated">üèÜ Entregado</span>`;
                            historyHtml = `
                                <div class="validation-history">
                                    <strong>üèÜ Premio Entregado</strong><br>
                                    <strong>Fecha de entrega:</strong> ${cuota.deliveryDate}<br>
                                    <strong>Confirmado por:</strong> ${cuota.deliveredBy}<br>
                                    <div class="timestamp">Cliente satisfecho - Proceso completado</div>
                                </div>
                            `;
                            break;
                            
                        case 'rejected':
                            statusHtml = `<span class="status-badge status-rejected">‚ùå Rechazada</span>`;
                            historyHtml = `
                                <div class="validation-history rejected">
                                    <strong>‚ùå Cuota Rechazada</strong><br>
                                    <strong>Rechazado por:</strong> ${cuota.rejectedBy}<br>
                                    <strong>Fecha:</strong> ${cuota.rejectionDate}<br>
                                    ${cuota.reason ? `<strong>Motivo:</strong> ${cuota.reason}<br>` : ''}
                                    <div class="timestamp">Cliente notificado para resubir comprobante</div>
                                </div>
                            `;
                            break;
                    }
                } else {
                    if (timeStatus === 'overdue') {
                        statusHtml = '<span class="status-badge status-overdue">üö® VENCIDA</span>';
                        filePreviewHtml = '<div class="file-preview"><p><strong>‚ö†Ô∏è CUOTA VENCIDA</strong><br>El cliente a√∫n no ha subido el comprobante de esta cuota</p></div>';
                    } else {
                        statusHtml = '<span class="status-badge">üìã No subida</span>';
                        filePreviewHtml = '<div class="file-preview"><p>El cliente a√∫n no ha subido el comprobante de esta cuota</p></div>';
                    }
                }
                
                cuotaCard.innerHTML = `
                    <div class="cuota-header">
                        <div class="cuota-number">Cuota ${i}</div>
                        ${statusHtml}
                    </div>
                    ${dueDateHtml}
                    ${filePreviewHtml}
                    ${historyHtml}
                    ${actionsHtml}
                `;
                
                cuotasGrid.appendChild(cuotaCard);
            }
            
            document.getElementById('clientModal').style.display = 'flex';
        }

        function validateCuota(clientId, cuotaNumber, isValid) {
            const client = clientsData.find(c => c.id === clientId);
            if (!client || !client.cuotas[cuotaNumber]) return;
            
            const reason = isValid ? null : prompt('Motivo del rechazo (opcional):');
            
            if (isValid) {
                client.cuotas[cuotaNumber].status = 'ready-delivery';
                client.cuotas[cuotaNumber].validatedBy = currentUser.name;
                client.cuotas[cuotaNumber].validationDate = new Date().toISOString().split('T')[0];
                
                simulateClientNotification(client, cuotaNumber, 'validated');
                alert(`‚úÖ Cuota ${cuotaNumber} validada correctamente.\n\nüì¶ El premio ahora est√° LISTO PARA ENTREGA.\nüìß Se ha notificado autom√°ticamente a ${client.nombre} ${client.apellido} que su premio fue aprobado.`);
            } else {
                client.cuotas[cuotaNumber].status = 'rejected';
                client.cuotas[cuotaNumber].rejectedBy = currentUser.name;
                client.cuotas[cuotaNumber].rejectionDate = new Date().toISOString().split('T')[0];
                if (reason) {
                    client.cuotas[cuotaNumber].reason = reason;
                }
                
                simulateClientNotification(client, cuotaNumber, 'rejected', reason);
                alert(`‚ùå Cuota ${cuotaNumber} rechazada.\n\nüìß Se ha notificado a ${client.nombre} ${client.apellido} que debe subir un nuevo comprobante.`);
            }
            
            syncWithClientSystem(clientId, cuotaNumber, client.cuotas[cuotaNumber]);
            
            viewClient(clientId);
            updateStats();
            renderTable();
        }

        function dispatchPrize(clientId, cuotaNumber) {
            if (currentUser.role !== 'owner' && currentUser.role !== 'responsable') {
                alert('No tienes permisos para despachar premios');
                return;
            }
            
            const client = clientsData.find(c => c.id === clientId);
            if (!client || !client.cuotas[cuotaNumber]) return;
            
            const trackingNumber = prompt('N√∫mero de seguimiento (opcional):') || `TR${Date.now().toString().slice(-8)}`;
            const carrier = prompt('Empresa de env√≠o:') || 'Correo Argentino';
            const estimatedDays = prompt('D√≠as estimados de entrega:') || '3-5';
            
            client.cuotas[cuotaNumber].status = 'dispatched';
            client.cuotas[cuotaNumber].dispatchedBy = currentUser.name;
            client.cuotas[cuotaNumber].dispatchDate = new Date().toISOString().split('T')[0];
            client.cuotas[cuotaNumber].trackingNumber = trackingNumber;
            client.cuotas[cuotaNumber].carrier = carrier;
            client.cuotas[cuotaNumber].estimatedDays = estimatedDays;
            
            sendTrackingEmail(client, cuotaNumber, trackingNumber, carrier, estimatedDays);
            
            alert(`üì¶ Premio DESPACHADO correctamente.\n\nüìß Se ha enviado email de seguimiento a ${client.nombre} ${client.apellido} con la informaci√≥n de env√≠o.`);
            
            viewClient(clientId);
            updateStats();
            renderTable();
        }

        function resendTrackingEmail(clientId, cuotaNumber) {
            const client = clientsData.find(c => c.id === clientId);
            const cuota = client.cuotas[cuotaNumber];
            
            sendTrackingEmail(client, cuotaNumber, cuota.trackingNumber, cuota.carrier, cuota.estimatedDays);
            alert(`üìß Email de seguimiento reenviado a ${client.nombre} ${client.apellido}`);
        }

        function markAsDelivered(clientId, cuotaNumber) {
            const client = clientsData.find(c => c.id === clientId);
            if (!client || !client.cuotas[cuotaNumber]) return;
            
            const confirmed = confirm('¬øConfirmas que el premio fue entregado exitosamente al cliente?');
            if (!confirmed) return;
            
            client.cuotas[cuotaNumber].status = 'delivered';
            client.cuotas[cuotaNumber].deliveredBy = currentUser.name;
            client.cuotas[cuotaNumber].deliveryDate = new Date().toISOString().split('T')[0];
            
            sendDeliveryConfirmationEmail(client, cuotaNumber);
            
            alert(`üèÜ Premio marcado como ENTREGADO.\n\nüìß Se ha enviado email de confirmaci√≥n a ${client.nombre} ${client.apellido}.`);
            
            viewClient(clientId);
            updateStats();
            renderTable();
        }

        function sendTrackingEmail(client, cuotaNumber, trackingNumber, carrier, estimatedDays) {
            const prizes = {
                2: 'üß¢ Gorra Mundial 2026',
                3: '‚öΩ Pelota de f√∫tbol Alra Mundial',
                4: 'üí∞ Voucher $1.000.000',
                5: 'üëï Camiseta Argentina Mundial 2026',
                6: 'üöó Polarizado',
                7: 'üá¶üá∑ Bandera Argentina Mundial 2026',
                8: '‚õΩ Tanque lleno de nafta',
                9: 'üèñÔ∏è Voucher vacacional',
                10: 'üéÅ Premio sorpresa',
                11: 'üèÜ Premio especial',
                12: 'üéâ Gran premio final'
            };
            
            const emailContent = `
¬°EXCELENTES NOTICIAS ${client.nombre.toUpperCase()} ${client.apellido.toUpperCase()}!

üéâ ¬°TU PREMIO YA EST√Å EN CAMINO! üéâ

Tu premio de la Cuota ${cuotaNumber} ha sido despachado y pronto llegar√° a tu domicilio.

üéÅ PREMIO DESPACHADO:
${prizes[cuotaNumber]}

üì¶ INFORMACI√ìN DE ENV√çO:
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
üìã N√∫mero de seguimiento: ${trackingNumber}
üöö Empresa de env√≠o: ${carrier}
üìç Direcci√≥n de entrega: ${client.direccion}, ${client.localidad} (${client.cp})
‚è∞ Tiempo estimado: ${estimatedDays} d√≠as h√°biles
üìÖ Fecha de despacho: ${new Date().toLocaleDateString('es-AR')}
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

¬°Gracias por participar en la Promoci√≥n Mundial 2026!

Equipo Promoci√≥n Mundial 2026
            `;
            
            console.log('üìß EMAIL DE SEGUIMIENTO ENVIADO:');
            console.log('Para:', client.email);
            console.log('Asunto: üéÅ ¬°Tu premio est√° en camino! - Promoci√≥n Mundial 2026');
            console.log('Contenido:');
            console.log(emailContent);
            console.log('---');
        }

        function sendDeliveryConfirmationEmail(client, cuotaNumber) {
            const prizes = {
                2: 'üß¢ Gorra Mundial 2026',
                3: '‚öΩ Pelota de f√∫tbol Alra Mundial',
                4: 'üí∞ Voucher $1.000.000',
                5: 'üëï Camiseta Argentina Mundial 2026',
                6: 'üöó Polarizado',
                7: 'üá¶üá∑ Bandera Argentina Mundial 2026',
                8: '‚õΩ Tanque lleno de nafta',
                9: 'üèñÔ∏è Voucher vacacional',
                10: 'üéÅ Premio sorpresa',
                11: 'üèÜ Premio especial',
                12: 'üéâ Gran premio final'
            };
            
            const emailContent = `
¬°FELICITACIONES ${client.nombre.toUpperCase()} ${client.apellido.toUpperCase()}!

üèÜ ¬°PREMIO ENTREGADO EXITOSAMENTE! üèÜ

Confirmamos que has recibido tu premio de la Cuota ${cuotaNumber}:

üéÅ PREMIO RECIBIDO:
${prizes[cuotaNumber]}

üì¶ CONFIRMACI√ìN DE ENTREGA:
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
üìÖ Fecha de entrega: ${new Date().toLocaleDateString('es-AR')}
üìç Entregado en: ${client.direccion}, ${client.localidad}
‚úÖ Estado: ENTREGADO EXITOSAMENTE
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

¬°Nos vemos en el pr√≥ximo premio!

Equipo Promoci√≥n Mundial 2026
            `;
            
            console.log('üìß EMAIL DE CONFIRMACI√ìN DE ENTREGA ENVIADO:');
            console.log('Para:', client.email);
            console.log('Asunto: üèÜ ¬°Premio entregado exitosamente! - Promoci√≥n Mundial 2026');
            console.log('Contenido:');
            console.log(emailContent);
            console.log('---');
        }

        function simulateClientNotification(client, cuotaNumber, status, reason = null) {
            const prizes = {
                2: 'Gorra Mundial 2026',
                3: 'Pelota de f√∫tbol Alra Mundial',
                4: 'Voucher $1.000.000',
                5: 'Camiseta Argentina Mundial 2026',
                6: 'Polarizado',
                7: 'Bandera Argentina Mundial 2026',
                8: 'Tanque lleno de nafta',
                9: 'Voucher vacacional'
            };
            
            if (status === 'validated') {
                console.log(`üìß EMAIL ENVIADO A: ${client.email}`);
                console.log(`üéâ ¬°Felicitaciones ${client.nombre}! Tu cuota ${cuotaNumber} ha sido validada.`);
                console.log(`üèÜ Ya puedes reclamar tu premio: ${prizes[cuotaNumber]}`);
                console.log(`üì± Ingresa a tu panel de cliente para reclamar tu premio.`);
            } else if (status === 'rejected') {
                console.log(`üìß EMAIL ENVIADO A: ${client.email}`);
                console.log(`‚ö†Ô∏è Hola ${client.nombre}, necesitamos que resubas el comprobante de la cuota ${cuotaNumber}.`);
                if (reason) {
                    console.log(`üìù Motivo: ${reason}`);
                }
                console.log(`üì± Ingresa a tu panel para subir un nuevo comprobante.`);
            }
        }

        function syncWithClientSystem(clientId, cuotaNumber, cuotaData) {
            const syncData = {
                clientId,
                cuotaNumber,
                status: cuotaData.status,
                validatedBy: cuotaData.validatedBy,
                validationDate: cuotaData.validationDate,
                rejectedBy: cuotaData.rejectedBy,
                rejectionDate: cuotaData.rejectionDate,
                reason: cuotaData.reason,
                timestamp: new Date().toISOString()
            };
            
            console.log('üîÑ SINCRONIZANDO CON SISTEMA DEL CLIENTE:', syncData);
            
            try {
                const clientKey = `${clientsData.find(c => c.id === clientId).nombre}_${clientsData.find(c => c.id === clientId).apellido}_data`;
                const clientLocalData = localStorage.getItem(clientKey);
                if (clientLocalData) {
                    const data = JSON.parse(clientLocalData);
                    data.validationStatus = data.validationStatus || {};
                    data.validationStatus[cuotaNumber] = cuotaData.status;
                    localStorage.setItem(clientKey, JSON.stringify(data));
                    console.log('‚úÖ Datos sincronizados con el sistema del cliente');
                }
            } catch (error) {
                console.log('‚ÑπÔ∏è Cliente no encontrado en esta sesi√≥n');
            }
        }

        function openImageModal(imageUrl, fileName) {
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.style.display = 'flex';
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 90%; max-height: 90%;">
                    <button class="close-modal" onclick="this.parentElement.parentElement.remove()">&times;</button>
                    <h3>üìÑ ${fileName}</h3>
                    <div style="text-align: center; margin-top: 20px;">
                        <img src="${imageUrl}" alt="${fileName}" style="max-width: 100%; max-height: 70vh; border-radius: 8px; box-shadow: 0 4px 15px rgba(0,0,0,0.2);">
                    </div>
                    <div style="text-align: center; margin-top: 20px;">
                        <button class="download-btn" onclick="downloadFile('${fileName}', '${imageUrl}')">
                            üì• Descargar Imagen
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            modal.onclick = function(event) {
                if (event.target === modal) {
                    modal.remove();
                }
            }
        }

        function viewPdfModal(fileName) {
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.style.display = 'flex';
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 90%; max-height: 90%;">
                    <button class="close-modal" onclick="this.parentElement.parentElement.remove()">&times;</button>
                    <h3>üìÑ Vista Previa: ${fileName}</h3>
                    <div style="text-align: center; margin-top: 20px; padding: 40px; background: #f8f9fa; border-radius: 8px;">
                        <div style="font-size: 4rem; margin-bottom: 20px;">üìÑ</div>
                        <p><strong>Archivo PDF:</strong> ${fileName}</p>
                        <p>En una aplicaci√≥n real, aqu√≠ se mostrar√≠a el contenido del PDF usando un visor como PDF.js</p>
                        <div style="margin-top: 20px;">
                            <div style="background: white; padding: 20px; border-radius: 8px; margin: 10px 0; border-left: 4px solid #27ae60;">
                                <strong>Comprobante de Pago</strong><br>
                                Banco: Banco Naci√≥n<br>
                                Importe: $150.000<br>
                                Fecha: 15/03/2024<br>
                                CBU: ‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢20
                            </div>
                        </div>
                        <button class="download-btn" onclick="downloadFile('${fileName}', 'data:application/pdf;base64,sample')">
                            üì• Descargar PDF
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            modal.onclick = function(event) {
                if (event.target === modal) {
                    modal.remove();
                }
            }
        }

        function downloadFile(fileName, fileUrl) {
            if (fileUrl.startsWith('data:application/pdf')) {
                alert(`üì• Descargando: ${fileName}\n\nEn una aplicaci√≥n real, aqu√≠ se iniciar√≠a la descarga del archivo PDF.`);
            } else {
                const a = document.createElement('a');
                a.href = fileUrl;
                a.download = fileName;
                a.click();
            }
        }

        function closeModal() {
            document.getElementById('clientModal').style.display = 'none';
        }

        function refreshData() {
            loadClientsData();
            updateStats();
            alert('Datos actualizados');
        }

        function exportData() {
            const data = JSON.stringify(clientsData, null, 2);
            const blob = new Blob([data], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'clientes_promocion_mundial.json';
            a.click();
            URL.revokeObjectURL(url);
        }

        function exportClient(clientId) {
            const client = clientsData.find(c => c.id === clientId);
            if (!client) return;
            
            const data = JSON.stringify(client, null, 2);
            const blob = new Blob([data], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `cliente_${client.dni}_${client.apellido}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        function generateReport() {
            let report = 'REPORTE DE PROMOCI√ìN MUNDIAL 2026\n';
            report += '=====================================\n\n';
            
            clientsData.forEach(client => {
                report += `Cliente: ${client.nombre} ${client.apellido}\n`;
                report += `DNI: ${client.dni}\n`;
                report += `Email: ${client.email}\n`;
                report += `Plan: ${client.plan}\n`;
                report += 'Cuotas:\n';
                
                Object.entries(client.cuotas).forEach(([num, cuota]) => {
                    report += `  - Cuota ${num}: ${cuota.status.toUpperCase()}`;
                    if (cuota.status === 'validated' && cuota.validatedBy) {
                        report += ` (Validada por ${cuota.validatedBy})`;
                    } else if (cuota.status === 'rejected' && cuota.rejectedBy) {
                        report += ` (Rechazada por ${cuota.rejectedBy})`;
                    }
                    report += '\n';
                });
                
                report += '\n';
            });
            
            const blob = new Blob([report], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'reporte_promocion_mundial.txt';
            a.click();
            URL.revokeObjectURL(url);
        }

        function openSettings() {
            alert('Funcionalidad de configuraci√≥n en desarrollo');
        }

        function sendAlerts() {
            const pendingClients = clientsData.filter(client => 
                Object.values(client.cuotas).some(cuota => cuota.status === 'pending')
            );
            
            alert(`Se enviar√°n alertas a ${pendingClients.length} clientes con cuotas pendientes de validaci√≥n`);
        }

        function showDetailedStats() {
            let totalFiles = 0;
            let totalClients = clientsData.length;
            let clientsWithPending = 0;
            let clientsFullyValidated = 0;
            
            clientsData.forEach(client => {
                const cuotas = Object.values(client.cuotas);
                totalFiles += cuotas.length;
                
                const hasPending = cuotas.some(c => c.status === 'pending');
                const allValidated = cuotas.length > 0 && cuotas.every(c => c.status === 'validated');
                
                if (hasPending) clientsWithPending++;
                if (allValidated) clientsFullyValidated++;
            });
            
            alert(`üìä ESTAD√çSTICAS DETALLADAS
            
Total de clientes: ${totalClients}
Total de archivos subidos: ${totalFiles}
Clientes con cuotas pendientes: ${clientsWithPending}
Clientes completamente validados: ${clientsFullyValidated}
Porcentaje de validaci√≥n: ${((clientsFullyValidated / totalClients) * 100).toFixed(1)}%`);
        }

        function showOnlyPending() {
            document.getElementById('statusFilter').value = 'pending';
            filterData();
        }

        function clearFilters() {
            document.getElementById('statusFilter').value = '';
            document.getElementById('cuotaFilter').value = '';
            document.getElementById('monthFilter').value = '';
            document.getElementById('searchInput').value = '';
            filterData();
        }

        function exportPendingOnly() {
            const pendingData = clientsData.map(client => {
                const pendingCuotas = Object.entries(client.cuotas)
                    .filter(([_, cuota]) => cuota.status === 'pending')
                    .reduce((acc, [num, cuota]) => {
                        acc[num] = cuota;
                        return acc;
                    }, {});
                
                if (Object.keys(pendingCuotas).length > 0) {
                    return {
                        ...client,
                        cuotas: pendingCuotas
                    };
                }
                return null;
            }).filter(Boolean);
            
            const data = JSON.stringify(pendingData, null, 2);
            const blob = new Blob([data], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'cuotas_pendientes.json';
            a.click();
            URL.revokeObjectURL(url);
        }

        window.onclick = function(event) {
            const modal = document.getElementById('clientModal');
            if (event.target === modal) {
                closeModal();
            }
        }
    </script>
</body>
</html>